## 功能概述

OKG 提供了原地升级（[热更新](../快速开始/游戏服热更新.md)）、批量更新、按优先级更新等多种更新策略，满足在实际生产场景下，对于用户把控更新范围、更新节奏的需求。

## 使用示例

本示例中将一组游戏服分成两批次更新，模拟灰度更新，逐步验证的场景。

此时GameServerSet下有4个游戏服副本：
```shell
kubectl get gs
NAME        STATE      OPSSTATE   DP    UP
gs-demo-0   Ready      None       0     0
gs-demo-1   Ready      None       0     0
gs-demo-2   Ready      None       0     0
gs-demo-3   Ready      None       0     0
```

设置更新优先级，将3号游戏服优先级调大：
```shell
kubectl edit gs gs-demo-3

...
spec:
  deletionPriority: 0
  opsState: None
  updatePriority: 10 #初始为0，调大成10
...
```

接下来设置 GameServerSet partition、以及即将更新的新镜像：
```shell
kubectl edit gss gs-demo

...
        image: gameserver:latest # 更新镜像
        name: gameserver
...
  updateStrategy:
    rollingUpdate:
      maxUnavailable: 5
      partition: 3 # 设置保留的游戏服数目，这里只更新一个，所以要保留余下3个
      podUpdatePolicy: InPlaceIfPossible
...

```

此时只有gs-demo-3将会更新:
```shell
kubectl get gs
NAME        STATE      OPSSTATE   DP    UP
gs-demo-0   Ready      None       0     0
gs-demo-1   Ready      None       0     0
gs-demo-2   Ready      None       0     0
gs-demo-3   Updating   None       0     10


# 一段时间过后
...

kubectl get gs
NAME        STATE      OPSSTATE   DP    UP
gs-demo-0   Ready      None       0     0
gs-demo-1   Ready      None       0     0
gs-demo-2   Ready      None       0     0
gs-demo-3   Ready      None       0     10
```

待gs-demo-3验证通过后，更新其余游戏服：
```shell
kubectl edit gss gs-demo
...
  updateStrategy:
    rollingUpdate:
      maxUnavailable: 5
      partition: 0 # 设置保留的游戏服数目，将其设置为0，更新余下全部
      podUpdatePolicy: InPlaceIfPossible
...

```

